<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏—Ç–Ω–µ—Å-–¢—Ä–µ–∫–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .menu-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .menu-item {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            padding: 20px;
            border-radius: 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .menu-item:active {
            transform: translateY(0);
        }

        .menu-icon {
            font-size: 24px;
        }

        .exercise-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .exercise-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .exercise-item:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .exercise-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .exercise-category {
            font-size: 12px;
            opacity: 0.8;
        }

        .custom-exercise {
            border-left: 4px solid #fbbf24;
        }

        .workout-form {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        .btn {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 16px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .hidden {
            display: none;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .history-date {
            font-weight: 600;
            margin-bottom: 8px;
            color: #34d399;
        }

        .history-exercise {
            margin-bottom: 5px;
        }

        .history-sets {
            font-size: 14px;
            opacity: 0.8;
        }

        .add-exercise-form {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .category-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .category-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .category-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .category-btn.selected {
            background: #34d399;
            border-color: #34d399;
        }

        .success-message {
            background: rgba(52, 211, 153, 0.2);
            border: 1px solid #34d399;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="mainScreen" class="screen">
            <div class="header">
                <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è –§–∏—Ç–Ω–µ—Å-–¢—Ä–µ–∫–µ—Ä</h1>
                <p>–¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalWorkouts">0</div>
                    <div class="stat-label">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalExercises">0</div>
                    <div class="stat-label">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                </div>
            </div>

            <div class="menu-grid">
                <button class="menu-item" onclick="showExercises()">
                    <span>üí™ –ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
                    <span class="menu-icon">‚Üí</span>
                </button>
                <button class="menu-item" onclick="showHistory()">
                    <span>üìä –ò—Å—Ç–æ—Ä–∏—è</span>
                    <span class="menu-icon">‚Üí</span>
                </button>
                <button class="menu-item" onclick="showStats()">
                    <span>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    <span class="menu-icon">‚Üí</span>
                </button>
                <button class="menu-item" onclick="showAddExercise()">
                    <span>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</span>
                    <span class="menu-icon">‚Üí</span>
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
        <div id="exercisesScreen" class="screen hidden">
            <div class="header">
                <h1>üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h1>
                <p>–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
            </div>

            <div class="exercise-list" id="exerciseList">
                <!-- –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>

            <button class="btn btn-secondary" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div id="workoutScreen" class="screen hidden">
            <div class="header">
                <h1 id="workoutExerciseName">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h1>
                <p id="workoutSetInfo">–ü–æ–¥—Ö–æ–¥ 1</p>
            </div>

            <div class="workout-form">
                <div class="form-group">
                    <label class="form-label">–í–µ—Å (–∫–≥)</label>
                    <input type="number" class="form-input" id="weightInput" placeholder="0 –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–µ—Å–∞">
                </div>

                <div class="form-group">
                    <label class="form-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</label>
                    <input type="number" class="form-input" id="repsInput" placeholder="10">
                </div>

                <button class="btn" onclick="addSet()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="finishWorkout()">üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
                </div>
            </div>

            <div id="currentSets" style="margin-top: 20px;">
                <!-- –¢–µ–∫—É—â–∏–µ –ø–æ–¥—Ö–æ–¥—ã -->
            </div>

            <button class="btn btn-secondary" onclick="showExercises()" style="margin-top: 20px;">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div id="historyScreen" class="screen hidden">
            <div class="header">
                <h1>üìä –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
                <p>–¢–≤–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
            </div>

            <div id="historyList">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>

            <button class="btn btn-secondary" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div id="statsScreen" class="screen hidden">
            <div class="header">
                <h1>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
                <p>–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
            </div>

            <div id="statsList">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>

            <button class="btn btn-secondary" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
        <div id="addExerciseScreen" class="screen hidden">
            <div class="header">
                <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h1>
                <p>–°–æ–∑–¥–∞–π —Å–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>
            </div>

            <div class="add-exercise-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
                    <input type="text" class="form-input" id="newExerciseName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–æ–ª–≥–∞—Ä—Å–∫–∏–µ —Å–ø–ª–∏—Ç-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è">
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <div class="category-buttons">
                        <button class="category-btn" onclick="selectCategory('–Ω–æ–≥–∏')">ü¶µ –ù–æ–≥–∏</button>
                        <button class="category-btn" onclick="selectCategory('–≥—Ä—É–¥—å')">üí™ –ì—Ä—É–¥—å</button>
                        <button class="category-btn" onclick="selectCategory('—Å–ø–∏–Ω–∞')">üîô –°–ø–∏–Ω–∞</button>
                        <button class="category-btn" onclick="selectCategory('—Ä—É–∫–∏')">üí™ –†—É–∫–∏</button>
                        <button class="category-btn" onclick="selectCategory('–ø–ª–µ—á–∏')">ü§∏ –ü–ª–µ—á–∏</button>
                        <button class="category-btn" onclick="selectCategory('–ø—Ä–µ—Å—Å')">üéØ –ü—Ä–µ—Å—Å</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–§–æ—Ç–æ (URL)</label>
                    <input type="url" class="form-input" id="newExercisePhoto" placeholder="https://example.com/photo.jpg">
                </div>

                <button class="btn" onclick="addNewExercise()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            </div>

            <button class="btn btn-secondary" onclick="showMain()" style="margin-top: 20px;">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let userData = {
            telegramId: tg.initDataUnsafe.user?.id || 12345,
            firstName: tg.initDataUnsafe.user?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
        };

        let currentWorkout = {
            exerciseId: null,
            exerciseName: '',
            sets: []
        };

        let selectedCategory = '';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            loadStats();
            showMain();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        function showMain() {
            hideAllScreens();
            document.getElementById('mainScreen').classList.remove('hidden');
            loadStats();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function showExercises() {
            hideAllScreens();
            document.getElementById('exercisesScreen').classList.remove('hidden');
            loadExercises();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏
        function showHistory() {
            hideAllScreens();
            document.getElementById('historyScreen').classList.remove('hidden');
            loadHistory();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStats() {
            hideAllScreens();
            document.getElementById('statsScreen').classList.remove('hidden');
            loadDetailedStats();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function showAddExercise() {
            hideAllScreens();
            document.getElementById('addExerciseScreen').classList.remove('hidden');
            selectedCategory = '';
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('selected'));
        }

        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function loadStats() {
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const stats = getStatsFromStorage();
            document.getElementById('totalWorkouts').textContent = stats.totalWorkouts;
            document.getElementById('totalExercises').textContent = stats.totalExercises;
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function loadExercises() {
            const exercises = getExercisesFromStorage();
            const exerciseList = document.getElementById('exerciseList');
            exerciseList.innerHTML = '';

            exercises.forEach(exercise => {
                const exerciseItem = document.createElement('div');
                exerciseItem.className = `exercise-item ${exercise.isCustom ? 'custom-exercise' : ''}`;
                exerciseItem.innerHTML = `
                    <div class="exercise-name">${exercise.isCustom ? 'üë§ ' : 'üí™ '}${exercise.name}</div>
                    <div class="exercise-category">${exercise.category}</div>
                `;
                exerciseItem.onclick = () => startWorkout(exercise);
                exerciseList.appendChild(exerciseItem);
            });
        }

        // –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
        function startWorkout(exercise) {
            currentWorkout = {
                exerciseId: exercise.id,
                exerciseName: exercise.name,
                sets: []
            };

            document.getElementById('workoutExerciseName').textContent = exercise.name;
            document.getElementById('workoutSetInfo').textContent = '–ü–æ–¥—Ö–æ–¥ 1';
            document.getElementById('weightInput').value = '';
            document.getElementById('repsInput').value = '';
            document.getElementById('currentSets').innerHTML = '';

            hideAllScreens();
            document.getElementById('workoutScreen').classList.remove('hidden');
        }

        // –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥
        function addSet() {
            const weight = parseFloat(document.getElementById('weightInput').value) || 0;
            const reps = parseInt(document.getElementById('repsInput').value);

            if (!reps || reps <= 0) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π', 'error');
                return;
            }

            currentWorkout.sets.push({ weight, reps });

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤
            updateCurrentSets();

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –ø–æ–¥—Ö–æ–¥–∞
            const setNumber = currentWorkout.sets.length + 1;
            document.getElementById('workoutSetInfo').textContent = `–ü–æ–¥—Ö–æ–¥ ${setNumber}`;

            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('weightInput').value = '';
            document.getElementById('repsInput').value = '';

            // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
            if (tg.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }

            showMessage(`–ü–æ–¥—Ö–æ–¥ ${currentWorkout.sets.length} –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
        function updateCurrentSets() {
            const currentSetsDiv = document.getElementById('currentSets');
            currentSetsDiv.innerHTML = '<h3 style="margin-bottom: 10px;">–¢–µ–∫—É—â–∏–µ –ø–æ–¥—Ö–æ–¥—ã:</h3>';

            currentWorkout.sets.forEach((set, index) => {
                const setDiv = document.createElement('div');
                setDiv.className = 'history-item';
                const weightText = set.weight === 0 ? '—Å–≤–æ–π –≤–µ—Å' : `${set.weight} –∫–≥`;
                setDiv.innerHTML = `
                    <div>–ü–æ–¥—Ö–æ–¥ ${index + 1}: ${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π (${weightText})</div>
                `;
                currentSetsDiv.appendChild(setDiv);
            });
        }

        // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
        function finishWorkout() {
            if (currentWorkout.sets.length === 0) {
                showMessage('–î–æ–±–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            saveWorkout(currentWorkout);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            const resultsText = currentWorkout.sets.map((set, index) => {
                const weightText = set.weight === 0 ? '—Å–≤–æ–π –≤–µ—Å' : `${set.weight} –∫–≥`;
                return `–ü–æ–¥—Ö–æ–¥ ${index + 1}: ${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π (${weightText})`;
            }).join('\n');

            showMessage(`–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n${currentWorkout.exerciseName}\n${resultsText}`, 'success');

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            setTimeout(() => {
                showMain();
            }, 2000);
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        function loadHistory() {
            const history = getHistoryFromStorage();
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>';
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ
            const groupedHistory = {};
            history.forEach(record => {
                const date = record.date.split(' ')[0];
                if (!groupedHistory[date]) {
                    groupedHistory[date] = [];
                }
                groupedHistory[date].push(record);
            });

            Object.keys(groupedHistory).forEach(date => {
                const dateDiv = document.createElement('div');
                dateDiv.className = 'history-item';
                dateDiv.innerHTML = `<div class="history-date">üìÖ ${date}</div>`;

                groupedHistory[date].forEach(record => {
                    const exerciseDiv = document.createElement('div');
                    exerciseDiv.className = 'history-exercise';
                    exerciseDiv.innerHTML = `üí™ ${record.exerciseName}`;
                    dateDiv.appendChild(exerciseDiv);

                    const setsDiv = document.createElement('div');
                    setsDiv.className = 'history-sets';
                    setsDiv.innerHTML = record.sets.map(set => {
                        const weightText = set.weight === 0 ? '—Å–≤–æ–π –≤–µ—Å' : `${set.weight} –∫–≥`;
                        return `  ‚Ä¢ ${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π (${weightText})`;
                    }).join('\n');
                    dateDiv.appendChild(setsDiv);
                });

                historyList.appendChild(dateDiv);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function loadDetailedStats() {
            const history = getHistoryFromStorage();
            const statsList = document.getElementById('statsList');
            statsList.innerHTML = '';

            if (history.length === 0) {
                statsList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>';
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º
            const exerciseStats = {};
            history.forEach(record => {
                if (!exerciseStats[record.exerciseName]) {
                    exerciseStats[record.exerciseName] = {
                        totalSets: 0,
                        totalReps: 0,
                        maxWeight: 0,
                        maxReps: 0
                    };
                }

                record.sets.forEach(set => {
                    exerciseStats[record.exerciseName].totalSets++;
                    exerciseStats[record.exerciseName].totalReps += set.reps;
                    exerciseStats[record.exerciseName].maxReps = Math.max(exerciseStats[record.exerciseName].maxReps, set.reps);
                    exerciseStats[record.exerciseName].maxWeight = Math.max(exerciseStats[record.exerciseName].maxWeight, set.weight);
                });
            });

            Object.keys(exerciseStats).forEach(exerciseName => {
                const stats = exerciseStats[exerciseName];
                const statsDiv = document.createElement('div');
                statsDiv.className = 'stat-card';
                statsDiv.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 10px;">üí™ ${exerciseName}</div>
                    <div>–ü–æ–¥—Ö–æ–¥—ã: ${stats.totalSets}</div>
                    <div>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è: ${stats.totalReps}</div>
                    <div>–ú–∞–∫—Å. –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è: ${stats.maxReps}</div>
                    ${stats.maxWeight > 0 ? `<div>–ú–∞–∫—Å. –≤–µ—Å: ${stats.maxWeight} –∫–≥</div>` : ''}
                `;
                statsList.appendChild(statsDiv);
            });
        }

        // –í—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        function selectCategory(category) {
            selectedCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
        function addNewExercise() {
            const name = document.getElementById('newExerciseName').value.trim();
            const photo = document.getElementById('newExercisePhoto').value.trim();

            if (!name) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', 'error');
                return;
            }

            if (!selectedCategory) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }

            const newExercise = {
                id: Date.now(),
                name: name,
                category: selectedCategory,
                photo: photo,
                isCustom: true
            };

            addExerciseToStorage(newExercise);
            showMessage('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!', 'success');

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('newExerciseName').value = '';
            document.getElementById('newExercisePhoto').value = '';
            selectedCategory = '';
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('selected'));

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            setTimeout(() => {
                showMain();
            }, 1500);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'success') {
            const existingMessage = document.querySelector('.success-message, .error-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = text;

            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);

            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage (–∏–º–∏—Ç–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
        function getExercisesFromStorage() {
            const exercises = localStorage.getItem('exercises');
            if (!exercises) {
                // –ë–∞–∑–æ–≤—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                const defaultExercises = [
                    { id: 1, name: '–ñ–∏–º –ª–µ–∂–∞', category: '–≥—Ä—É–¥—å', isCustom: false },
                    { id: 2, name: '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π', category: '–Ω–æ–≥–∏', isCustom: false },
                    { id: 3, name: '–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞', category: '—Å–ø–∏–Ω–∞', isCustom: false },
                    { id: 4, name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', category: '—Å–ø–∏–Ω–∞', isCustom: false },
                    { id: 5, name: '–ê—Ä–º–µ–π—Å–∫–∏–π –∂–∏–º', category: '–ø–ª–µ—á–∏', isCustom: false },
                    { id: 6, name: '–ë–∏—Ü–µ–ø—Å —Å–æ —à—Ç–∞–Ω–≥–æ–π', category: '—Ä—É–∫–∏', isCustom: false },
                    { id: 7, name: '–¢—Ä–∏—Ü–µ–ø—Å –Ω–∞ –±–ª–æ–∫–µ', category: '—Ä—É–∫–∏', isCustom: false },
                    { id: 8, name: '–°–≥–∏–±–∞–Ω–∏—è –Ω–æ–≥ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ', category: '–Ω–æ–≥–∏', isCustom: false },
                    { id: 9, name: '–ì–∏–ø–µ—Ä—ç–∫—Å—Ç–µ–Ω–∑–∏—è', category: '—Å–ø–∏–Ω–∞', isCustom: false },
                    { id: 10, name: '–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è', category: '–ø—Ä–µ—Å—Å', isCustom: false }
                ];
                localStorage.setItem('exercises', JSON.stringify(defaultExercises));
                return defaultExercises;
            }
            return JSON.parse(exercises);
        }

        function addExerciseToStorage(exercise) {
            const exercises = getExercisesFromStorage();
            exercises.push(exercise);
            localStorage.setItem('exercises', JSON.stringify(exercises));
        }

        function getHistoryFromStorage() {
            const history = localStorage.getItem('workoutHistory');
            return history ? JSON.parse(history) : [];
        }

        function saveWorkout(workout) {
            const history = getHistoryFromStorage();
            const workoutRecord = {
                id: Date.now(),
                exerciseName: workout.exerciseName,
                exerciseId: workout.exerciseId,
                sets: workout.sets,
                date: new Date().toISOString()
            };
            history.push(workoutRecord);
            localStorage.setItem('workoutHistory', JSON.stringify(history));
        }

        function getStatsFromStorage() {
            const history = getHistoryFromStorage();
            const exercises = getExercisesFromStorage();
            
            return {
                totalWorkouts: history.length,
                totalExercises: exercises.length
            };
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initApp);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ Telegram
        tg.onEvent('backButtonPressed', () => {
            showMain();
        });
    </script>
</body>
</html>
